<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>1RM è¨ˆç®—å™¨ - FitMotion</title>
  <link rel="stylesheet" href="../css/style.css">
</head>
<body>
  <nav class="navbar">
    <div class="container">
      <a href="../index.html" class="navbar-brand">ğŸ’ª FitMotion</a>
      <ul class="navbar-nav">
        <li><a href="../index.html" class="nav-link">é¦–é </a></li>
        <li><a href="exercise-library.html" class="nav-link">å‹•ä½œè³‡æ–™åº«</a></li>
        <li><a href="workout-plan.html" class="nav-link">è¨“ç·´è¨ˆç•«</a></li>
        <li><a href="training-log.html" class="nav-link">è¨“ç·´è¨˜éŒ„</a></li>
        <li><a href="statistics.html" class="nav-link">çµ±è¨ˆåˆ†æ</a></li>
      </ul>
    </div>
  </nav>

  <main class="main-content">
    <div class="container">
      <h1 class="mb-3">ğŸ§® 1RM è¨ˆç®—å™¨</h1>

      <div class="grid grid-2">
        <!-- æ‰‹å‹•è¨ˆç®—å™¨ -->
        <div class="card">
          <div class="card-header">âš¡ å¿«é€Ÿè¨ˆç®—</div>
          <div class="card-body">
            <p style="color: #666; margin-bottom: 1.5rem;">
              è¼¸å…¥ä½ èƒ½èˆ‰èµ·çš„é‡é‡å’Œæ¬¡æ•¸ï¼Œç«‹å³è¨ˆç®—é ä¼°çš„ 1RMï¼ˆä¸€æ¬¡æœ€å¤§é‡é‡ï¼‰
            </p>

            <div class="form-group">
              <label class="form-label">é‡é‡ (kg)</label>
              <input type="number" id="manual-weight" class="form-input" placeholder="ä¾‹å¦‚ï¼š80" min="1" step="0.5">
            </div>

            <div class="form-group">
              <label class="form-label">æ¬¡æ•¸ (reps)</label>
              <input type="number" id="manual-reps" class="form-input" placeholder="ä¾‹å¦‚ï¼š8" min="1" max="100">
            </div>

            <div class="card" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 2rem; text-align: center; margin-top: 1rem;">
              <div style="font-size: 0.9rem; opacity: 0.9; margin-bottom: 0.5rem;">é ä¼° 1RM</div>
              <div id="manual-result" style="font-size: 3rem; font-weight: bold;">-- kg</div>
              <div style="font-size: 0.85rem; opacity: 0.8; margin-top: 0.5rem;">åŸºæ–¼ Epley å…¬å¼è¨ˆç®—</div>
            </div>

            <!-- ç™¾åˆ†æ¯”åƒè€ƒè¡¨ -->
            <div class="card mt-3">
              <div style="font-weight: bold; margin-bottom: 1rem;">ğŸ“Š è¨“ç·´å¼·åº¦åƒè€ƒ</div>
              <div id="percentage-table" style="font-size: 0.9rem;">
                <p style="color: #999;">è¼¸å…¥é‡é‡å’Œæ¬¡æ•¸å¾Œé¡¯ç¤º</p>
              </div>
            </div>
          </div>
        </div>

        <!-- åŸºæ–¼æ­·å²è¨˜éŒ„ -->
        <div class="card">
          <div class="card-header">ğŸ“ˆ åŸºæ–¼è¨“ç·´è¨˜éŒ„</div>
          <div class="card-body">
            <p style="color: #666; margin-bottom: 1.5rem;">
              æ ¹æ“šä½ çš„æ­·å²è¨“ç·´è¨˜éŒ„ï¼ŒæŸ¥çœ‹å„å‹•ä½œçš„é ä¼° 1RM
            </p>

            <div class="form-group">
              <label class="form-label">é¸æ“‡å‹•ä½œ</label>
              <select id="exercise-selector" class="form-select">
                <option value="">-- é¸æ“‡å‹•ä½œ --</option>
              </select>
            </div>

            <div id="exercise-1rm-result"></div>
          </div>
        </div>
      </div>

      <!-- 1RM èªªæ˜ -->
      <div class="card mt-4">
        <div class="card-header">â„¹ï¸ ä»€éº¼æ˜¯ 1RMï¼Ÿ</div>
        <div class="card-body">
          <div class="grid grid-2">
            <div>
              <h3>å®šç¾©</h3>
              <p>
                1RM (One Repetition Maximum) æ˜¯æŒ‡ä½ åœ¨ä¿æŒæ­£ç¢ºå§¿å‹¢ä¸‹ï¼Œèƒ½å¤ å®Œæˆã€Œä¸€æ¬¡å®Œæ•´å‹•ä½œã€çš„æœ€å¤§é‡é‡ã€‚
              </p>

              <h3 class="mt-3">è¨ˆç®—å…¬å¼</h3>
              <p>
                æœ¬ç³»çµ±ä½¿ç”¨ <strong>Epley å…¬å¼</strong>ï¼š
                <br><code style="background: #f8f9fa; padding: 0.5rem; border-radius: 4px; display: inline-block; margin-top: 0.5rem;">
                  1RM = é‡é‡ Ã— (1 + æ¬¡æ•¸ / 30)
                </code>
              </p>
            </div>

            <div>
              <h3>è¨“ç·´å¼·åº¦å»ºè­°</h3>
              <ul style="list-style: none; padding: 0;">
                <li style="margin-bottom: 0.5rem;">ğŸ’ª <strong>90-100% 1RM</strong>ï¼šæœ€å¤§åŠ›é‡è¨“ç·´ (1-3æ¬¡)</li>
                <li style="margin-bottom: 0.5rem;">ğŸ‹ï¸ <strong>80-90% 1RM</strong>ï¼šåŠ›é‡è¨“ç·´ (3-6æ¬¡)</li>
                <li style="margin-bottom: 0.5rem;">ğŸ’ª <strong>70-80% 1RM</strong>ï¼šè‚Œè‚¥å¤§è¨“ç·´ (6-12æ¬¡)</li>
                <li style="margin-bottom: 0.5rem;">ğŸƒ <strong>60-70% 1RM</strong>ï¼šè‚Œè€åŠ›è¨“ç·´ (12-20æ¬¡)</li>
              </ul>

              <div class="card mt-3" style="background: #fff3cd; border-left: 4px solid #ffc107;">
                <p style="margin: 0; font-size: 0.9rem;">
                  <strong>âš ï¸ æ³¨æ„ï¼š</strong>åˆå­¸è€…ä¸å»ºè­°ç›´æ¥æ¸¬è©¦ 1RMï¼Œè«‹å¾ªåºæ¼¸é€²ï¼Œä¸¦åœ¨æœ‰æ•™ç·´æŒ‡å°ä¸‹é€²è¡Œã€‚
                </p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </main>
<script src="../js/api.js"></script> 
<script src="../js/auth-api.js"></script>
  <script>
    let allExercises = [];

    document.addEventListener('DOMContentLoaded', async () => {
      await loadExercises();
      setupManualCalculator();
      setupExerciseSelector();
    });

    async function loadExercises() {
      allExercises = await fetchExercises();
      const selector = document.getElementById('exercise-selector');
      
      allExercises.forEach(exercise => {
        const option = document.createElement('option');
        option.value = exercise._id;
        option.textContent = exercise.name;
        selector.appendChild(option);
      });
    }

    // æ‰‹å‹•è¨ˆç®—å™¨
    function setupManualCalculator() {
      const weightInput = document.getElementById('manual-weight');
      const repsInput = document.getElementById('manual-reps');
      const resultDisplay = document.getElementById('manual-result');
      const percentageTable = document.getElementById('percentage-table');
      
      function calculate() {
        const weight = parseFloat(weightInput.value);
        const reps = parseInt(repsInput.value);
        
        if (weight > 0 && reps > 0) {
          const oneRM = calculateEpley1RM(weight, reps);
          resultDisplay.textContent = `${oneRM} kg`;
          
          // é¡¯ç¤ºç™¾åˆ†æ¯”åƒè€ƒè¡¨
          percentageTable.innerHTML = `
            <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 0.5rem;">
              <div style="padding: 0.5rem; background: #f8f9fa; border-radius: 4px;">
                <strong>100%:</strong> ${oneRM} kg
              </div>
              <div style="padding: 0.5rem; background: #f8f9fa; border-radius: 4px;">
                <strong>95%:</strong> ${Math.round(oneRM * 0.95 * 10) / 10} kg
              </div>
              <div style="padding: 0.5rem; background: #f8f9fa; border-radius: 4px;">
                <strong>90%:</strong> ${Math.round(oneRM * 0.9 * 10) / 10} kg
              </div>
              <div style="padding: 0.5rem; background: #f8f9fa; border-radius: 4px;">
                <strong>85%:</strong> ${Math.round(oneRM * 0.85 * 10) / 10} kg
              </div>
              <div style="padding: 0.5rem; background: #f8f9fa; border-radius: 4px;">
                <strong>80%:</strong> ${Math.round(oneRM * 0.8 * 10) / 10} kg
              </div>
              <div style="padding: 0.5rem; background: #f8f9fa; border-radius: 4px;">
                <strong>75%:</strong> ${Math.round(oneRM * 0.75 * 10) / 10} kg
              </div>
              <div style="padding: 0.5rem; background: #f8f9fa; border-radius: 4px;">
                <strong>70%:</strong> ${Math.round(oneRM * 0.7 * 10) / 10} kg
              </div>
              <div style="padding: 0.5rem; background: #f8f9fa; border-radius: 4px;">
                <strong>65%:</strong> ${Math.round(oneRM * 0.65 * 10) / 10} kg
              </div>
            </div>
          `;
        } else {
          resultDisplay.textContent = '-- kg';
          percentageTable.innerHTML = '<p style="color: #999;">è¼¸å…¥é‡é‡å’Œæ¬¡æ•¸å¾Œé¡¯ç¤º</p>';
        }
      }
      
      weightInput.addEventListener('input', calculate);
      repsInput.addEventListener('input', calculate);
    }

    // åŸºæ–¼æ­·å²è¨˜éŒ„
    function setupExerciseSelector() {
      document.getElementById('exercise-selector').addEventListener('change', async (e) => {
        const exerciseId = e.target.value;
        const container = document.getElementById('exercise-1rm-result');
        
        if (!exerciseId) {
          container.innerHTML = '';
          return;
        }
        
        container.innerHTML = '<p class="text-center" style="color: #999; padding: 2rem;">è¨ˆç®—ä¸­...</p>';
        
        const data = await calculate1RM(exerciseId);
        
        if (!data || data.estimated1RM === 0) {
          container.innerHTML = '<p class="text-center" style="color: #999; padding: 2rem;">è©²å‹•ä½œé‚„æ²’æœ‰è¨“ç·´è¨˜éŒ„</p>';
          return;
        }
        
        const exerciseName = allExercises.find(ex => ex._id === exerciseId)?.name || 'æœªçŸ¥å‹•ä½œ';
        
        container.innerHTML = `
          <div class="card" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); color: white; padding: 2rem; text-align: center; margin-top: 1rem;">
            <div style="font-size: 1rem; opacity: 0.9; margin-bottom: 0.5rem;">${exerciseName}</div>
            <div style="font-size: 3rem; font-weight: bold;">${data.estimated1RM} kg</div>
            <div style="font-size: 0.85rem; opacity: 0.9; margin-top: 0.5rem;">
              åŸºæ–¼ ${data.basedOn.weight}kg Ã— ${data.basedOn.reps} æ¬¡<br>
              è¨˜éŒ„æ—¥æœŸï¼š${new Date(data.basedOn.date).toLocaleDateString('zh-TW')}
            </div>
          </div>
          
          ${data.history.length > 1 ? `
            <div class="card mt-3">
              <div style="font-weight: bold; margin-bottom: 1rem;">ğŸ“Š æ­·å² 1RM ç´€éŒ„</div>
              <div style="max-height: 300px; overflow-y: auto;">
                ${data.history.map((record, index) => `
                  <div style="padding: 0.75rem; margin-bottom: 0.5rem; background: #f8f9fa; border-radius: 8px; display: flex; justify-content: space-between; align-items: center;">
                    <div>
                      <strong>${record.estimated1RM} kg</strong>
                      <span style="color: #666; font-size: 0.9rem; margin-left: 0.5rem;">
                        (${record.weight}kg Ã— ${record.reps}æ¬¡)
                      </span>
                    </div>
                    <small style="color: #999;">${new Date(record.date).toLocaleDateString('zh-TW')}</small>
                  </div>
                `).join('')}
              </div>
            </div>
          ` : ''}
        `;
      });
    }
  </script>
</body>
</html>