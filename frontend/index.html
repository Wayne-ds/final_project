<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>FitMotion - å¥èº«å‹•ä½œè³‡æ–™åº«</title>
  <link rel="stylesheet" href="css/style.css" />
</head>

<body>
  <nav class="navbar">
    <div class="container">
      <a href="index.html" class="navbar-brand">ğŸ’ª FitMotion</a>
      <ul class="navbar-nav">
        <li><a href="index.html" class="nav-link active">é¦–é </a></li>
        <li><a href="pages/exercise-library.html" class="nav-link">å‹•ä½œè³‡æ–™åº«</a></li>
        <li><a href="pages/workout-plan.html" class="nav-link">è¨“ç·´è¨ˆç•«</a></li>
        <li><a href="pages/training-log.html" class="nav-link">è¨“ç·´è¨˜éŒ„</a></li>
        <li><a href="pages/statistics.html" class="nav-link">çµ±è¨ˆåˆ†æ</a></li>
        <!-- ğŸ†• å°ˆæ¡ˆå ±å‘Šé€£çµï¼ˆå°èˆªåˆ—ï¼‰ -->
        <li><a href="https://docs.google.com/presentation/d/16Ej0R6bwrLB0MJcFFdYWcWsNVGUvm2Hp/edit?slide=id.p2#slide=id.p2" class="nav-link" target="_blank">ğŸ“„ å°ˆæ¡ˆå ±å‘Š</a></li>
      </ul>
      <div id="auth-buttons" style="margin-left: auto; display: flex; gap: 0.5rem;">
        <a href="pages/login.html" class="btn btn-outline" style="padding: 0.5rem 1rem; font-size: 0.9rem;">ç™»å…¥</a>
        <a href="pages/register.html" class="btn btn-primary" style="padding: 0.5rem 1rem; font-size: 0.9rem;">è¨»å†Š</a>
      </div>
    </div>
  </nav>

  <main class="main-content">
    <div class="container">
      <!-- ğŸ†• å°ˆæ¡ˆå ±å‘Šå¡ç‰‡ï¼ˆé¦–é é ‚éƒ¨ï¼‰ -->
      <div class="card mb-4" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none;">
        <div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 1rem;">
          <div style="flex: 1; min-width: 250px;">
            <h2 style="margin: 0 0 0.5rem 0; color: white;">ğŸ“„ å°ˆæ¡ˆå ±å‘Š</h2>
            <p style="margin: 0; opacity: 0.9;">æŸ¥çœ‹å®Œæ•´çš„å°ˆæ¡ˆé–‹ç™¼ç°¡å ±èˆ‡åŠŸèƒ½èªªæ˜</p>
          </div>
          <a href="https://docs.google.com/presentation/d/16Ej0R6bwrLB0MJcFFdYWcWsNVGUvm2Hp/edit?slide=id.p2#slide=id.p2" 
             target="_blank" 
             class="btn" 
             style="background: white; color: #667eea; font-weight: bold; display: flex; align-items: center; gap: 0.5rem;">
            æŸ¥çœ‹ç°¡å ±
            <span style="font-size: 1.2rem;">ğŸ”—</span>
          </a>
        </div>
      </div>

      <section class="text-center mb-4">
        <h1>æ­¡è¿ä¾†åˆ° FitMotion ğŸ‹ï¸</h1>
        <p style="font-size: 1.2rem; color: #666;">
          ä½ çš„å€‹äººå¥èº«åŠ©æ‰‹ï¼Œè®“è¨“ç·´è®Šå¾—ç°¡å–®æœ‰è¶£
        </p>
      </section>

      <section class="card mb-4">
        <div class="card-header">ğŸ“… ä»Šæ—¥è¨“ç·´</div>
        <div class="card-body" id="today-workout">
          <p class="text-center" style="color: #999;">è¼‰å…¥ä¸­...</p>
        </div>
      </section>

      <section>
        <h2 class="mb-3">ğŸš€ å¿«é€Ÿé–‹å§‹</h2>
        <div class="grid grid-3">
          <div class="card">
            <div style="font-size: 3rem; text-align: center; margin-bottom: 1rem;">ğŸ“š</div>
            <h3 class="text-center">å‹•ä½œè³‡æ–™åº«</h3>
            <p style="text-align: center; color: #666; margin-bottom: 1rem;">
              ç€è¦½ 12+ å€‹å¥èº«å‹•ä½œï¼ŒåŒ…å«å½±ç‰‡æ•™å­¸èˆ‡è©³ç´°èªªæ˜
            </p>
            <a href="pages/exercise-library.html" class="btn btn-primary" style="width: 100%;">
              é–‹å§‹ç€è¦½
            </a>
          </div>

          <div class="card">
            <div style="font-size: 3rem; text-align: center; margin-bottom: 1rem;">ğŸ“‹</div>
            <h3 class="text-center">è¨“ç·´è¨ˆç•«</h3>
            <p style="text-align: center; color: #666; margin-bottom: 1rem;">
              ç”¨æ‹–æ”¾æ–¹å¼è¼•é¬†ç·¨æ’ä½ çš„æ¯é€±è¨“ç·´è¨ˆç•«
            </p>
            <a href="pages/workout-plan.html" class="btn btn-primary" style="width: 100%;">
              æŸ¥çœ‹è¨ˆç•«
            </a>
          </div>

          <div class="card">
            <div style="font-size: 3rem; text-align: center; margin-bottom: 1rem;">ğŸ“Š</div>
            <h3 class="text-center">è¨“ç·´è¨˜éŒ„</h3>
            <p style="text-align: center; color: #666; margin-bottom: 1rem;">
              è¨˜éŒ„æ¯æ¬¡è¨“ç·´ï¼Œè¿½è¹¤ä½ çš„é€²æ­¥è»Œè·¡
            </p>
            <a href="pages/training-log.html" class="btn btn-primary" style="width: 100%;">
              é–‹å§‹è¨˜éŒ„
            </a>
          </div>
        </div>
      </section>

      <section class="mt-4">
        <h2 class="mb-3">ğŸ“ˆ æœ¬é€±çµ±è¨ˆ</h2>
        <div class="grid grid-4">
          <div class="card text-center">
            <div id="total-exercises" style="font-size: 2rem; color: var(--primary-color);">0</div>
            <div style="color: #666;">ç¸½å‹•ä½œæ•¸</div>
          </div>
          <div class="card text-center">
            <div id="total-workouts" style="font-size: 2rem; color: var(--secondary-color);">0</div>
            <div style="color: #666;">æœ¬é€±è¨“ç·´</div>
          </div>
          <div class="card text-center">
            <div id="total-logs" style="font-size: 2rem; color: var(--accent-color);">0</div>
            <div style="color: #666;">ç¸½è¨˜éŒ„æ•¸</div>
          </div>
          <div class="card text-center">
            <div style="font-size: 2rem; color: var(--success-color);">ğŸ”¥</div>
            <div style="color: #666;">æŒçºŒè¨“ç·´ä¸­</div>
          </div>
        </div>
      </section>
    </div>
  </main>

  <script src="js/api.js"></script>
  <script src="js/auth-api.js"></script>
  <script>
    document.addEventListener("DOMContentLoaded", async () => {
      await initAuthState();
      
      await loadTodayWorkout();
      await loadStatistics();
    });

    async function loadTodayWorkout() {
      try {
        const plan = await fetchWeeklyPlan();
        if (!plan) {
          document.getElementById("today-workout").innerHTML = 
            '<p class="text-center" style="color:#999;">è«‹å…ˆ<a href="pages/login.html" style="color: var(--primary-color);">ç™»å…¥</a>æŸ¥çœ‹ä»Šæ—¥è¨“ç·´</p>';
          return;
        }
        
        const days = ["sunday", "monday", "tuesday", "wednesday", "thursday", "friday", "saturday"];
        const todayDay = days[new Date().getDay()];
        const todayWorkout = plan.weeklyPlan[todayDay];
        const container = document.getElementById("today-workout");

        if (!todayWorkout || todayWorkout.length === 0) {
          container.innerHTML = '<p class="text-center" style="color:#999;">ä»Šå¤©æ²’æœ‰å®‰æ’è¨“ç·´ï¼Œä¼‘æ¯ä¸€ä¸‹å§ï¼ ğŸ˜Š</p>';
          return;
        }

        container.innerHTML = '<div class="grid grid-2"></div>';
        const grid = container.querySelector(".grid");

        todayWorkout.forEach(item => {
          if (!item.exerciseId) return;
          
          const card = document.createElement("div");
          card.className = "card";
          
          const nameH4 = document.createElement("h4");
          nameH4.textContent = item.exerciseId.name || "æœªçŸ¥å‹•ä½œ";
          
          const tagsP = document.createElement("p");
          tagsP.style.color = "#666";
          tagsP.innerHTML = `
            <span class="tag tag-primary">${escapeHtml(item.exerciseId.targetMuscle || "")}</span>
            <span class="tag tag-secondary">${escapeHtml(item.exerciseId.difficulty || "")}</span>
          `;
          
          const setsP = document.createElement("p");
          setsP.style.marginTop = "0.5rem";
          setsP.innerHTML = `<strong>${item.sets || 3} çµ„ Ã— ${item.reps || 10} æ¬¡</strong>`;
          
          card.appendChild(nameH4);
          card.appendChild(tagsP);
          card.appendChild(setsP);
          grid.appendChild(card);
        });
      } catch (err) {
        console.error("è¼‰å…¥ä»Šæ—¥è¨“ç·´å¤±æ•—:", err);
        document.getElementById("today-workout").innerHTML =
          '<p class="text-center" style="color:#999;">è¼‰å…¥å¤±æ•—ï¼Œè«‹é‡æ–°æ•´ç†é é¢</p>';
      }
    }

    async function loadStatistics() {
      try {
        const exercises = await fetchExercises();
        document.getElementById("total-exercises").textContent = exercises.length;

        const logs = await fetchAllLogs();
        document.getElementById("total-logs").textContent = logs.length;

        const oneWeekAgo = new Date();
        oneWeekAgo.setDate(oneWeekAgo.getDate() - 7);
        const thisWeekLogs = logs.filter(log => new Date(log.date) >= oneWeekAgo);
        const uniqueDays = new Set(thisWeekLogs.map(log => new Date(log.date).toDateString()));
        document.getElementById("total-workouts").textContent = uniqueDays.size;
      } catch (err) {
        console.error("è¼‰å…¥çµ±è¨ˆå¤±æ•—:", err);
      }
    }
  </script>
</body>
</html>